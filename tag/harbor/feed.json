{
    "version": "https://jsonfeed.org/version/1",
    "title": "上善若水 • All posts by \"harbor\" tag",
    "description": "若能避开猛烈的欢喜，自然也不会有悲痛的来袭.",
    "home_page_url": "http://yunyat.cloud",
    "items": [
        {
            "id": "http://yunyat.cloud/linux/harbor%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA/",
            "url": "http://yunyat.cloud/linux/harbor%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA/",
            "title": "harbor本地仓库搭建",
            "date_published": "2023-09-12T03:34:02.000Z",
            "content_html": "<h4 id=\"创建-harbor-仓库\"><a class=\"markdownIt-Anchor\" href=\"#创建-harbor-仓库\">#</a> 创建 Harbor 仓库</h4>\n<ol>\n<li>访问官方网站下载官方镜像源</li>\n</ol>\n<blockquote>\n<p>官方网站： <span class=\"exturl\" data-url=\"aHR0cHM6Ly9nb2hhcmJvci5pby8=\">Harbor (goharbor.io)</span></p>\n</blockquote>\n<ol start=\"2\">\n<li>使用 scp 将下载的官方镜像上传到服务器</li>\n</ol>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>scp <span class=\"token operator\">-</span>P 2000 <span class=\"token punctuation\">.</span>\\harbor-offline-installer-v2<span class=\"token punctuation\">.</span>7<span class=\"token punctuation\">.</span>3<span class=\"token punctuation\">.</span>tgz root@你服务器的ip:<span class=\"token operator\">/</span>root/</pre></td></tr></table></figure><p>注：使用 -P 参数可以指定 scp 的端口号</p>\n<p><img data-src=\"https://s1.ax1x.com/2023/09/12/pPg4W1U.png\" alt=\"pPg4W1U.png\"></p>\n<ol start=\"3\">\n<li>使用下面的命令解压文件</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> harbor-offline-installer-v2.7.3.tgz</pre></td></tr></table></figure><ol start=\"4\">\n<li>使用 vim 更改 harbor.yml.tmep 的内容</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> harbor.yml.tmep</pre></td></tr></table></figure><p>将 hostname 修改为自己的 ip 地址，然后将 https 全部注释掉，同时也可以更改密码</p>\n<p><img data-src=\"https://s1.ax1x.com/2023/09/12/pPgHXgP.png\" alt=\"pPgHXgP.png\"></p>\n<ol start=\"5\">\n<li>使用 yum 下载 epel-release 及 docker-compose</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> epel-release <span class=\"token punctuation\">;</span> yum <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> <span class=\"token function\">docker-compose</span></pre></td></tr></table></figure><p>注：由于不可抗力的原因（我服务器带不动 [倒] ），下面的所有演示都是在我室友的虚拟机上完成的</p>\n<p><img data-src=\"https://s1.ax1x.com/2023/09/12/pPgORaD.png\" alt=\"pPgORaD.png\"></p>\n<p><img data-src=\"https://s1.ax1x.com/2023/09/12/pPgO2VO.png\" alt=\"pPgO2VO.png\"></p>\n<ol start=\"6\">\n<li>安装 harbor</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mv</span> ./harbor.yml.tmep ./harbor.yml <span class=\"token punctuation\">;</span> ./install.sh</pre></td></tr></table></figure><p>注：安装之前请先将 harbor.yml.tmep 文件改为 harbor.yml ，要不然会找不到文件</p>\n<p><img data-src=\"https://s1.ax1x.com/2023/09/12/pPgXj0K.png\" alt=\"pPgXj0K.png\"></p>\n<ol start=\"7\">\n<li>在浏览器中访问</li>\n</ol>\n<p>在浏览器中输入：</p>\n<blockquote>\n<p>你的 IP/harbor</p>\n<p>由于我用的是室友的电脑中的虚拟机来做的，在我电脑上是直接访问不到虚拟机里的，所以做了个 net 端口转发使我电脑能够访问，你们在自己的浏览器中就不需要输入端口号了，默认 80</p>\n</blockquote>\n<p><img data-src=\"https://s1.ax1x.com/2023/09/12/pPgjrB6.png\" alt=\"pPgjrB6.png\"></p>\n<ol start=\"8\">\n<li>输入账号密码</li>\n</ol>\n<blockquote>\n<p>账号默认为 admin，密码默认为 Harbor12345，如果你更改了默认密码那就填你改的密码</p>\n</blockquote>\n<p><img data-src=\"https://s1.ax1x.com/2023/09/12/pPgjXgs.png\" alt=\"pPgjXgs.png\"></p>\n<ol start=\"9\">\n<li>点击新建项目来新建一个仓库</li>\n</ol>\n<p><img data-src=\"https://s1.ax1x.com/2023/09/12/pPgvLdK.png\" alt=\"pPgvLdK.png\"></p>\n<ol start=\"10\">\n<li>修改 Docker 配置</li>\n</ol>\n<p>因为我使用的使 http 协议，而 docker 默认为 https，所以需要将本地私有仓库添加到信任仓库中</p>\n<p>使用下面的命令修改配置文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/docker/daemon.json</pre></td></tr></table></figure><p>注意：你在配置 daemon 文件的时候，除了最后一个键值对后面不用英文逗号，其他都要</p>\n<p><img data-src=\"https://z1.ax1x.com/2023/09/13/pPRpcxe.png\" alt=\"pPRpcxe.png\"></p>\n<ol start=\"11\">\n<li>刷新刚刚编辑的 daemon.json 文件并重启 docker</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl daemon.json <span class=\"token punctuation\">;</span> systemctl restart <span class=\"token function\">docker</span></pre></td></tr></table></figure><ol start=\"12\">\n<li>给要推送的镜像添加 tag 标签</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> tag centos:centos7 <span class=\"token number\">192.168</span>.100.10/zero/centos:centos7<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 注：ip 后面的为你在仓库命名空间创建的仓库名</span></pre></td></tr></table></figure><p><img data-src=\"https://z1.ax1x.com/2023/09/13/pPRAdS0.png\" alt=\"pPRAdS0.png\"></p>\n<ol start=\"13\">\n<li>在终端登录至搭建的 harbor 私有仓库</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> login http://192.168.100.10 <span class=\"token parameter variable\">-u</span> admin <span class=\"token parameter variable\">-p</span> <span class=\"token number\">123456</span></pre></td></tr></table></figure><p><img data-src=\"https://z1.ax1x.com/2023/09/13/pPRAUWq.png\" alt=\"pPRAUWq.png\"></p>\n<ol start=\"14\">\n<li>使用 push 命令上传镜像</li>\n</ol>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> push <span class=\"token number\">192.168</span>.100.10/zero/centos:centos7</pre></td></tr></table></figure><p><img data-src=\"https://z1.ax1x.com/2023/09/13/pPRANYn.png\" alt=\"pPRANYn.png\"></p>\n<ol start=\"15\">\n<li>从浏览器进入 harbor 仓库管理界面</li>\n</ol>\n<p><img data-src=\"https://z1.ax1x.com/2023/09/13/pPRAwlV.png\" alt=\"pPRAwlV.png\"></p>\n<p>可以看到，已经上传到 zero 仓库了</p>\n<hr>\n<p>END</p>\n",
            "tags": [
                "原创",
                "Docker",
                "harbor"
            ]
        }
    ]
}